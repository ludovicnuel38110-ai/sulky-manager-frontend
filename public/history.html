<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Sulky-Bet â€“ Mes paris</title>
<link rel="stylesheet" href="style.css">

<style>

/* ================= BACKGROUND ================= */

body{
  background:
    linear-gradient(rgba(0,0,0,.6), rgba(0,0,0,.8)),
    url("images/bg.jpg");
  background-size:cover;
  background-position:center;
  background-attachment:fixed;
}

/* ================= LAYOUT ================= */

.history-wrapper{
  max-width:1200px;
  margin:80px auto;
  padding:20px;
}

/* ================= CARD ================= */

.history-card{
  background:rgba(0,110,55,.55);
  backdrop-filter:blur(14px);

  border-radius:22px;
  padding:40px;

  border:1px solid rgba(0,255,136,.6);

  box-shadow:
    0 0 40px rgba(0,255,136,.25),
    inset 0 0 25px rgba(0,0,0,.4);
}

/* ================= HEADER ================= */

.top-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:30px;
}

.balance{
  font-size:20px;
  color:#00ff88;
}

/* ================= STATS ================= */

.stats-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
  gap:20px;
  margin-bottom:30px;
}

.stat{
  background:rgba(0,0,0,.5);
  padding:20px;
  border-radius:14px;
  text-align:center;
  border:1px solid rgba(0,255,136,.5);
}

.stat h3{
  margin-bottom:5px;
  font-size:14px;
  opacity:.7;
}

.stat p{
  font-size:20px;
  font-weight:bold;
}

/* ================= FILTERS ================= */

.filters{
  display:flex;
  gap:12px;
  margin-bottom:20px;
}

.filters button{
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
}

/* ================= TABLE ================= */

table{
  width:100%;
  border-collapse:collapse;
}

th{
  background:#001a0f;
  color:#00ff88;
  padding:12px;
}

td{
  padding:10px;
  background:rgba(0,0,0,.55);
}

tr.win td{ background:rgba(0,255,136,.12); }
tr.lose td{ background:rgba(255,0,0,.12); }
tr.pending td{ background:rgba(255,200,0,.12); }

.back-btn{
  margin-top:25px;
  width:100%;
}

</style>
</head>

<body>

<div class="history-wrapper">

  <div class="history-card">

    <div class="top-bar">
      <h2>ðŸ“œ Historique des paris</h2>
      <span id="balanceBox" class="balance">ðŸ’° 0 â‚¬</span>
    </div>


    <!-- STATS -->
    <div class="stats-grid">
      <div class="stat">
        <h3>Total paris</h3>
        <p id="statTotal">0</p>
      </div>
      <div class="stat">
        <h3>GagnÃ©s</h3>
        <p id="statWin">0</p>
      </div>
      <div class="stat">
        <h3>Perdus</h3>
        <p id="statLose">0</p>
      </div>
      <div class="stat">
        <h3>Profit</h3>
        <p id="statProfit">0 â‚¬</p>
      </div>
    </div>


    <!-- FILTRES -->
    <div class="filters">
      <button onclick="filterBets('all')">Tous</button>
      <button onclick="filterBets('win')">GagnÃ©s</button>
      <button onclick="filterBets('lose')">Perdus</button>
      <button onclick="filterBets('pending')">En attente</button>
    </div>


    <!-- TABLE -->
    <table>
      <thead>
        <tr>
          <th>Course</th>
          <th>Type</th>
          <th>Chevaux</th>
          <th>Mise</th>
          <th>Gain</th>
          <th>Statut</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody id="betsTable"></tbody>
    </table>


    <button class="bet-btn back-btn" onclick="window.location.href='dashboard.html'">
      â¬… Retour dashboard
    </button>

  </div>

</div>


<script>
const token = localStorage.getItem("token");
if(!token) location.href="login.html";

const balance = localStorage.getItem("balance") || 0;
balanceBox.innerText = "ðŸ’° " + balance + " â‚¬";

let allBets = [];

/* ================= LOAD BETS ================= */

fetch("https://sulky-manager-backend.onrender.com/api/bets/me",{
  headers:{ Authorization:"Bearer "+token }
})
.then(r=>r.json())
.then(bets=>{
  allBets = bets;
  renderTable(bets);
  computeStats(bets);
});

/* ================= RENDER ================= */

function renderTable(bets){

  betsTable.innerHTML="";

  bets.forEach(b=>{

    const tr=document.createElement("tr");
    tr.className=b.status;

    const chevaux=(b.chevaux||[])
      .map(h=>h.cheval)
      .join(", ");

    tr.innerHTML=`
      <td>${b.raceId}</td>
      <td>${b.type}</td>
      <td>${chevaux}</td>
      <td>${b.montant}â‚¬</td>
      <td>${b.gain || 0}â‚¬</td>
      <td>${b.status}</td>
      <td>${new Date(b.createdAt).toLocaleDateString()}</td>
    `;

    betsTable.appendChild(tr);
  });
}

/* ================= STATS ================= */

function computeStats(bets){

  const total=bets.length;
  const win=bets.filter(b=>b.status==="win").length;
  const lose=bets.filter(b=>b.status==="lose").length;

  const profit=bets.reduce((acc,b)=>acc+(b.gain||0)-b.montant,0);

  statTotal.innerText=total;
  statWin.innerText=win;
  statLose.innerText=lose;
  statProfit.innerText=profit+" â‚¬";
}

/* ================= FILTER ================= */

function filterBets(type){

  if(type==="all"){
    renderTable(allBets);
    return;
  }

  renderTable(allBets.filter(b=>b.status===type));
}

</script>

</body>
</html>
