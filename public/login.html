<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Sulky-Bet ‚Äì Connexion</title>
<link rel="stylesheet" href="style.css">

<style>

/* ================= LOADER ================= */

#loader{
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;

  background:#000;
  color:#00ff88;

  font-size:20px;
  z-index:9999;
}

.spinner{
  width:40px;
  height:40px;
  border:4px solid #003d22;
  border-top:4px solid #00ff88;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin-bottom:15px;
}

@keyframes spin{
  to{ transform:rotate(360deg); }
}


/* ================= LOGIN BOX ================= */

.login-box{
  display:none; /* üî• cach√© au d√©but */
  max-width:400px;
  margin:120px auto;
}

</style>
</head>

<body>

<!-- ================= LOADER ================= -->

<div id="loader">
  <div class="spinner"></div>
  <div id="loaderText">Connexion au serveur‚Ä¶</div>
</div>


<!-- ================= LOGIN ================= -->

<div class="login-box form-container">

  <h2>Connexion</h2>

  <input id="pseudo" placeholder="Pseudo">
  <input id="password" type="password" placeholder="Mot de passe">

  <button id="loginBtn">Se connecter</button>

  <p id="msg"></p>

</div>



<script>

const API = "https://sulky-manager-backend.onrender.com";

/* =================================================
   WAIT BACKEND (Render cold start safe)
================================================= */

async function waitBackend(){

  const loaderText = document.getElementById("loaderText");

  while(true){

    try{
      await fetch(API + "/api/health");
      break;
    }
    catch{
      loaderText.innerText = "D√©marrage du serveur‚Ä¶ patience";
      await new Promise(r=>setTimeout(r,2000));
    }

  }

  loaderText.innerText = "‚úÖ Serveur pr√™t";

  setTimeout(()=>{
    document.getElementById("loader").style.display="none";
    document.querySelector(".login-box").style.display="block";
  },600);
}


/* =================================================
   LOGIN
================================================= */

document.getElementById("loginBtn").onclick = async ()=>{

  const pseudo = document.getElementById("pseudo").value;
  const password = document.getElementById("password").value;
  const msg = document.getElementById("msg");

  try{

    const res = await fetch(API + "/api/users/login",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({pseudo,password})
    });

    const data = await res.json();

    if(!data.token)
      return msg.innerText="‚ùå Identifiants incorrects";

    localStorage.setItem("token",data.token);

    location.href="dashboard.html";

  }
  catch{
    msg.innerText="Erreur connexion serveur";
  }

};


/* ================================================= */

waitBackend();

</script>

</body>
</html>
