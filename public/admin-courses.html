<!DOCTYPE html>
<html lang="fr">

<head>
<meta charset="UTF-8">
<title>Sulky-Bet ‚Äì Admin Courses</title>
<link rel="stylesheet" href="style.css">

<style>

/* ================= BACKGROUND ================= */

body{
  background:
    linear-gradient(rgba(0,0,0,.75),rgba(0,0,0,.9)),
    url("images/bg.jpg");
  background-size:cover;
  background-position:center;
  background-attachment:fixed;
  font-family:Segoe UI, sans-serif;
  color:white;
}


/* ================= LAYOUT ================= */

.admin-wrapper{
  max-width:1300px;
  margin:80px auto;
  padding:20px;
}

.admin-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(360px,1fr));
  gap:30px;
}


/* ================= HEADER ================= */

.top-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:40px;
}

.top-bar h2{
  color:#00ff88;
  text-shadow:0 0 12px #00ff88;
}


/* ================= CARDS ================= */

.admin-card{
  background:rgba(0,110,55,.6);
  backdrop-filter:blur(12px);
  border-radius:22px;
  padding:28px;
  border:1px solid rgba(0,255,136,.6);
  box-shadow:0 0 35px rgba(0,255,136,.25);
}

.admin-card h3{
  color:#00ff88;
  margin-bottom:15px;
}


/* ================= INPUTS ================= */

input, textarea{
  width:100%;
  margin-top:10px;
  padding:12px;
  border-radius:10px;
  border:none;
  background:rgba(0,0,0,.6);
  color:#fff;
}

textarea{
  height:170px;
}


/* ================= BUTTONS ================= */

button{
  width:100%;
  margin-top:15px;
  padding:14px;
  border:none;
  border-radius:12px;
  background:linear-gradient(135deg,#00ff88,#00cc66);
  font-weight:bold;
  cursor:pointer;
  transition:.2s;
}

button:hover{
  transform:scale(1.03);
  box-shadow:0 0 25px #00ff88;
}


/* ================= MESSAGE ================= */

.msg{
  margin-top:25px;
  text-align:center;
  font-weight:bold;
  color:#00ff88;
  font-size:18px;
}

</style>
</head>


<body>

<div class="admin-wrapper">

  <div class="top-bar">
    <h2>üõ†Ô∏è Gestion des courses</h2>
    <button onclick="location.href='dashboard.html'">‚¨Ö Retour dashboard</button>
  </div>


  <div class="admin-grid">

    <!-- ================= REUNION ================= -->
    <div class="admin-card">
      <h3>üèüÔ∏è R√©union</h3>

      <input id="rName" placeholder="R1 ‚Äì VINCENNES">
      <input id="rDate" placeholder="Dimanche 01 f√©vrier 2026">

      <button id="btnReunion">Cr√©er la r√©union</button>

      <input id="delReunionId" placeholder="ID √† supprimer">
      <button id="btnDeleteReunion">üóë Supprimer r√©union</button>
    </div>


    <!-- ================= COURSE ================= -->
    <div class="admin-card">
      <h3>üèá Course</h3>

      <input id="cReunion" placeholder="Reunion ID">
      <input id="cId" placeholder="ID course (101)">
      <input id="cLabel" placeholder="C1 ‚Äì Prix du Test">
      <input id="cDate" placeholder="01/02/2026">

      <button id="btnCourse">Ajouter la course</button>

      <button id="btnDeleteCourse">üóë Supprimer course</button>
    </div>


    <!-- ================= RUNNER ================= -->
    <div class="admin-card">
      <h3>üêé Chevaux</h3>

      <input id="pReunion" placeholder="Reunion ID">
      <input id="pRace" placeholder="Race ID">

      <input id="pCheval" placeholder="Nom du cheval">
      <input id="pDriver" placeholder="Driver">
      <input id="pProp" placeholder="Propri√©taire">
      <input id="pMusique" placeholder="Musique">
      <input id="pCote" placeholder="Cote ex: 3.5">

      <button id="btnRunner">Ajouter le partant</button>

      <h3 style="margin-top:25px;">‚ö° Import automatique PMU</h3>

      <textarea id="bulkInput" placeholder="Colle la liste compl√®te ici"></textarea>
      <button id="btnBulk">Importer tous les chevaux</button>
    </div>

  </div>

  <p id="msg" class="msg"></p>

</div>



<!-- ======================================================
   JAVASCRIPT CLEAN & GLOBAL SAFE
====================================================== -->

<script>

/* ================= GLOBALS ================= */

const token = localStorage.getItem("token");
if(!token) location.href="login.html";

const API = "https://sulky-manager-backend.onrender.com/api/admin";
const msg = document.getElementById("msg");


/* ================= FETCH HELPER ================= */

async function post(url, body){
  const res = await fetch(API+url,{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer "+token
    },
    body:JSON.stringify(body)
  });
  return res.json();
}


/* ================= EVENTS ================= */

btnReunion.onclick = createReunion;
btnCourse.onclick = addCourse;
btnRunner.onclick = addRunner;
btnBulk.onclick = importBulk;
btnDeleteReunion.onclick = deleteReunion;
btnDeleteCourse.onclick = deleteCourse;


/* ================= CREATE ================= */

async function createReunion(){
  const res = await post("/create-reunion",{
    reunion:rName.value,
    date:rDate.value
  });
  msg.innerText = res.message + " | ID: " + res.id;
}


async function addCourse(){
  const res = await post("/add-course",{
    reunionId:cReunion.value,
    id:Number(cId.value),
    label:cLabel.value,
    date:cDate.value
  });
  msg.innerText = res.message;
}


async function addRunner(){
  const res = await post("/add-runner",{
    reunionId:pReunion.value,
    raceId:Number(pRace.value),
    cheval:pCheval.value,
    driver:pDriver.value,
    proprietaire:pProp.value,
    musique:pMusique.value,
    cote:Number(pCote.value)
  });
  msg.innerText = res.message;
}


/* ================= BULK IMPORT ================= */

async function importBulk(){

  const reunionId = pReunion.value;
  const raceId = Number(pRace.value);

  const lines = bulkInput.value.split("\n").map(l=>l.trim()).filter(Boolean);

  let created = 0;

  for(let i=0;i<lines.length;i++){

    if(/^\d+$/.test(lines[i])){

      const cheval = lines[i+1];
      const driver = lines[i+2];

      let coteLine = lines.slice(i).find(l=>/\d+\.\d+/);
      const cote = parseFloat(coteLine?.match(/\d+\.\d+/)?.[0] || 3);

      await post("/add-runner",{
        reunionId, raceId, cheval, driver,
        proprietaire:"-",
        musique:"-",
        cote
      });

      created++;
    }
  }

  msg.innerText = created + " chevaux import√©s automatiquement ‚úÖ";
}


/* ================= DELETE ================= */

async function deleteReunion(){

  const id = delReunionId.value;

  if(!confirm("Supprimer la r√©union ?")) return;

  const res = await fetch(API+"/delete-reunion/"+id,{
    method:"DELETE",
    headers:{ Authorization:"Bearer "+token }
  }).then(r=>r.json());

  msg.innerText = res.message;
}


async function deleteCourse(){

  if(!confirm("Supprimer la course ?")) return;

  const res = await fetch(API+"/delete-course",{
    method:"DELETE",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer "+token
    },
    body:JSON.stringify({
      reunionId:cReunion.value,
      raceId:Number(cId.value)
    })
  }).then(r=>r.json());

  msg.innerText = res.message;
}

</script>

</body>
</html>
