<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Sulky-Bet ‚Äì Dashboard</title>
<link rel="stylesheet" href="style.css">

<style>

/* ================= LAYOUT ================= */

.dashboard-wrapper{
  max-width:1100px;
  margin:90px auto;
  padding:20px;
}

/* ================= CARD PRINCIPALE ================= */

.dashboard-card{
  background:rgba(0,110,55,.65);
  backdrop-filter:blur(10px);
  border-radius:22px;
  padding:50px;
  text-align:center;

  border:1px solid rgba(0,255,136,.6);

  box-shadow:
    0 0 40px rgba(0,255,136,.25),
    inset 0 0 25px rgba(0,0,0,.35);
}

/* ================= TITRES ================= */

#welcome{
  font-size:38px;
  margin-bottom:8px;
}

#balance{
  font-size:30px;
  margin-bottom:40px;

  color:#00ff88;

  text-shadow:
    0 0 12px #00ff88,
    0 0 30px rgba(0,255,136,1);
}

/* ================= BOUTONS PRINCIPAUX ================= */

.actions-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:25px;
  margin-top:30px;
}

.big-btn{
  padding:22px;
  font-size:18px;
  font-weight:bold;
  border-radius:14px;

  background:linear-gradient(135deg,#00ff88,#00cc66);
  color:#001a0f;

  cursor:pointer;

  box-shadow:0 0 20px rgba(0,255,136,.6);

  transition:.25s;
}

.big-btn:hover{
  transform:translateY(-4px) scale(1.04);
  box-shadow:0 0 40px #00ff88;
}

/* ================= HEADER PREMIUM ================= */

header{
  background:linear-gradient(to bottom,#001a0f,#000);
  border-bottom:2px solid #00ff88;
}

/* ================= ADMIN PANEL ================= */

#adminPanel{
  margin-top:55px;

  padding:25px;

  background:rgba(0,0,0,.55);

  border-radius:16px;

  border:2px solid #00ff88;

  display:none;

  box-shadow:0 0 25px rgba(0,255,136,.35);
}

#adminPanel h3{
  color:#00ff88;
  margin-bottom:15px;
}

#adminPanel input{
  width:100%;
  padding:12px;
  margin-top:10px;
}

.admin-btn{
  width:100%;
  margin-top:12px;
}

.logout-btn{
  position:absolute;
  right:20px;
  top:20px;
}

</style>
</head>

<body>

<header>
  <h1>SULKY-BET</h1>
  <button class="big-btn logout-btn" onclick="logout()">üö™ D√©connexion</button>
</header>


<div class="dashboard-wrapper">

  <div class="dashboard-card">

    <h1 id="welcome">Bienvenue</h1>
    <h2 id="balance">Solde : ... ‚Ç¨</h2>

    <!-- ACTIONS JOUEUR -->
    <div class="actions-grid">

      <button class="big-btn" onclick="goRaces()">
        üèá Voir les courses
      </button>

      <button class="big-btn" onclick="goHistory()">
        üìú Mes paris
      </button>

      <button class="big-btn" onclick="window.location.href='index.html'">
        üè† Accueil
      </button>

    </div>


    <!-- ADMIN -->
    <div id="adminPanel">

      <h3>üõ†Ô∏è Administration</h3>

      <input id="creditPseudo" placeholder="Pseudo joueur">
      <input id="creditAmount" type="number" placeholder="Montant">

      <button class="big-btn admin-btn" onclick="creditUser()">üí∞ Cr√©diter</button>

      <button class="big-btn admin-btn" onclick="goSettle()">
        ‚öôÔ∏è R√©gler une course
      </button>

      <p id="adminMsg"></p>

    </div>

  </div>

</div>


<script>
const token = localStorage.getItem("token");
if (!token) window.location.href = "login.html";

const payload = JSON.parse(atob(token.split(".")[1]));

/* USER INFO */
fetch("https://sulky-manager-backend.onrender.com/api/users/me", {
  headers:{ Authorization:"Bearer "+token }
})
.then(res=>res.json())
.then(data=>{
  document.getElementById("welcome").innerText="Bienvenue "+data.pseudo;
  document.getElementById("balance").innerText="Solde : "+data.balance+" ‚Ç¨";
  localStorage.setItem("balance",data.balance);

  if(payload.isAdmin){
    document.getElementById("adminPanel").style.display="block";
  }
});


/* ACTIONS */
function logout(){
  localStorage.clear();
  window.location.href="index.html";
}

function goRaces(){
  window.location.href="races.html";
}

function goHistory(){
  window.location.href="history.html";
}

function goSettle(){
  window.location.href="admin-settle.html";
}

/* CREDIT */
function creditUser(){
  const pseudo=document.getElementById("creditPseudo").value;
  const amount=document.getElementById("creditAmount").value;

  fetch("https://sulky-manager-backend.onrender.com/api/admin/add-balance",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer "+token
    },
    body:JSON.stringify({pseudo,amount})
  })
  .then(r=>r.json())
  .then(d=>{
    document.getElementById("adminMsg").innerText=d.message;
  });
}
</script>

</body>
</html>
