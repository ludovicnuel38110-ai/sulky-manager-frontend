<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Sulky-Bet â€“ Dashboard</title>
<link rel="stylesheet" href="style.css">

<style>

/* ================= BACKGROUND ================= */

body{
  background:
    linear-gradient(rgba(0,0,0,.55), rgba(0,0,0,.75)),
    url("images/bg.jpg");
  background-size:cover;
  background-position:center;
  background-attachment:fixed;
}


/* ================= HEADER ================= */

header{
  background:linear-gradient(to bottom,#001a0f,#000);
  border-bottom:2px solid #00ff88;
  text-align:center;
  padding:25px;
  position:relative;
}

.logout-btn{
  position:absolute;
  right:20px;
  top:20px;
}


/* ================= ACTU BUTTON ================= */

.news-bar{
  text-align:center;
  margin-top:15px;
}

.news-btn{
  padding:12px 28px;
  font-weight:bold;
  border-radius:12px;
  border:none;
  background:linear-gradient(135deg,#00ff88,#00cc66);
  color:#001a0f;
  cursor:pointer;
  box-shadow:0 0 20px rgba(0,255,136,.6);
  transition:.25s;
}

.news-btn:hover{
  transform:scale(1.05);
}


/* ================= LAYOUT ================= */

.dashboard-wrapper{
  max-width:1200px;
  margin:70px auto;
  padding:25px;
}


/* ================= CARD ================= */

.dashboard-card{
  background:rgba(0,110,55,.55);
  backdrop-filter:blur(14px);

  border-radius:26px;
  padding:60px;

  border:1px solid rgba(0,255,136,.6);

  box-shadow:
    0 0 45px rgba(0,255,136,.25),
    inset 0 0 35px rgba(0,0,0,.45);

  text-align:center;
}


/* ================= TITRES ================= */

#welcome{
  font-size:40px;
  margin-bottom:20px;
}

#balance{
  font-size:32px;
  margin-bottom:45px;
  color:#00ff88;
  text-shadow:
    0 0 12px #00ff88,
    0 0 35px rgba(0,255,136,1);
}


/* ================= MESSAGE ACCUEIL ================= */

.welcome-msg{
  max-width:850px;
  margin:0 auto 35px auto;
  font-size:15px;
  line-height:1.6;
  opacity:.95;
}


/* ================= GRID ================= */

.actions-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(230px,1fr));
  gap:25px;
}


/* ================= BOUTONS ================= */

.big-btn{
  padding:26px;
  font-size:18px;
  font-weight:700;
  border-radius:18px;
  background:linear-gradient(135deg,#00ff88,#00cc66);
  color:#001a0f;
  cursor:pointer;
  box-shadow:0 0 25px rgba(0,255,136,.6);
  transition:.25s;
}

.big-btn:hover{
  transform:translateY(-6px) scale(1.05);
  box-shadow:0 0 45px #00ff88;
}


/* ================= ADMIN PANEL ================= */

#adminPanel{
  margin-top:55px;
  padding:30px;
  background:rgba(0,0,0,.6);
  border-radius:18px;
  border:2px solid #00ff88;
  display:none;
  box-shadow:0 0 30px rgba(0,255,136,.35);
}

#adminPanel input{
  width:100%;
  padding:12px;
  margin-top:10px;
}

.admin-btn{
  width:100%;
  margin-top:12px;
}

#adminMsg{
  margin-top:12px;
  font-weight:bold;
}

</style>
</head>


<body>

<header>
  <h1>SULKY-BET</h1>
  <button id="logoutBtn" class="big-btn logout-btn">DÃ©connexion</button>

  <!-- BOUTON ACTUS PLUS VISIBLE -->
  <div class="news-bar">
    <button class="news-btn" onclick="location.href='actus.html'">ğŸ“° ActualitÃ©s hippiques</button>
  </div>
</header>


<div class="dashboard-wrapper">

  <div class="dashboard-card">

    <h1 id="welcome">Bienvenue</h1>

    <!-- MESSAGE ACCUEIL -->
    <div class="welcome-msg">
      ğŸ‘‹ Bienvenue sur <b>Sulky-Bet</b> !<br><br>

      Parie simplement sur les courses disponibles dans la rubrique <b>Courses</b> et suis tes paris en toute tranquillitÃ©.<br><br>

      Pour le moment, seules quelques combinaisons de paris sont proposÃ©es, mais la plateforme Ã©voluera progressivement avec de nouvelles fonctionnalitÃ©s.<br><br>

      ğŸ’¬ Pour crÃ©diter ton compte, contacte-moi sur <b>Sulkyland</b> au pseudo <b>Turfiste83</b>.  
      Je reverserai les fonds le plus rapidement possible sur ton solde afin que tu puisses jouer.<br><br>

      ğŸ” Pense bien Ã  conserver ton pseudo et ton mot de passe.<br><br>

      Merci pour ta confiance et bons paris ğŸ‡
    </div>

    <h2 id="balance">Solde : ... â‚¬</h2>


    <!-- ACTIONS -->
    <div class="actions-grid">

      <button class="big-btn" id="btnRaces">ğŸ‡ Courses</button>
      <button class="big-btn" id="btnHistory">ğŸ“œ Mes paris</button>
      <button class="big-btn" id="btnResults">ğŸ RÃ©sultats</button>
      <button class="big-btn" id="btnHome">ğŸ  Accueil</button>

    </div>


    <!-- ADMIN -->
    <div id="adminPanel">

      <h3>âš™ï¸ Administration</h3>

      <input id="creditPseudo" placeholder="Pseudo joueur">
      <input id="creditAmount" type="number" placeholder="Montant">

      <button class="big-btn admin-btn" id="btnCourses">ğŸ—ï¸ GÃ©rer les courses</button>
      <button class="big-btn admin-btn" id="btnCredit">ğŸ’° CrÃ©diter</button>
      <button class="big-btn admin-btn" id="btnSettle">ğŸ RÃ©gler une course</button>

      <p id="adminMsg"></p>

    </div>

  </div>

</div>



<script>
document.addEventListener("DOMContentLoaded", async () => {

  const token = localStorage.getItem("token");
  if(!token) return location.href="login.html";

  const welcome = document.getElementById("welcome");
  const balanceBox = document.getElementById("balance");
  const adminPanel = document.getElementById("adminPanel");
  const adminMsg = document.getElementById("adminMsg");

  /* ================= USER INFO ================= */

  try{
    const res = await fetch(
      "https://sulky-manager-backend.onrender.com/api/users/me",
      { headers:{ Authorization:"Bearer "+token } }
    );

    const user = await res.json();

    welcome.innerText = "Bienvenue " + user.pseudo;
    balanceBox.innerText = "Solde : " + user.balance + " â‚¬";

    localStorage.setItem("balance", user.balance);

    const payload = JSON.parse(atob(token.split(".")[1]));
    if(payload.isAdmin) adminPanel.style.display="block";

  }catch{
    localStorage.clear();
    location.href="login.html";
  }


  /* ================= NAVIGATION ================= */

  btnRaces.onclick = ()=>location.href="races.html";
  btnHistory.onclick = ()=>location.href="history.html";
  btnResults.onclick = ()=>location.href="results.html";
  btnHome.onclick = ()=>location.href="index.html";
  btnSettle.onclick = ()=>location.href="admin-settle.html";
  btnCourses.onclick = ()=>location.href="admin-courses.html";

  logoutBtn.onclick = ()=>{
    localStorage.clear();
    location.href="index.html";
  };

});
</script>

</body>
</html>
